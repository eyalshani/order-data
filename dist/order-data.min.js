!function(r){var n={};function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=r,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,r){r(1),r(2),r(3),r(4),r(5),r(6),r(7),r(8),r(9),r(10),r(11),r(12),r(13),r(14),r(15),e.exports=r(16)},function(e,t,r){"use strict";var n=function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e};function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),console.log("order-data library version : 1.0.0"),void 0===e?console.log("no option data was supplied to order-data library"):this.orderViewService=new window.OrderDataLib.OrderViewService(e)}window.OrderDataLib=(n(o,[{key:"getEnrichOrder",value:function(e,t,r,n,a,o,i,s){return this.orderViewService.TimeLine.enrichOrder({tlog:e,tables:t,items:r,users:n,promotions:a,modifierGroups:o,tlogId:i,offers:s})}}]),o)},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){!function(e){e.local&&(i.local=e.local);void 0!==e.isUS&&(i.isUS=e.isUS,Q=e.isUS);F=e.moment?e.moment:window.moment;H=new window.OrderDataLib.TranslateService({local:i.local}),s=new window.OrderDataLib.Utils,q=new window.OrderDataLib.DiscountsService({local:i.local}),Y=new window.OrderDataLib.PromotionsService,V=new window.OrderDataLib.TimeLineService({local:i.local}),G=new window.OrderDataLib.UserService,new window.OrderDataLib.OthService({local:i.local}),B=new window.OrderDataLib.TableService({local:i.local}),X=new window.OrderDataLib.PaymentsService({local:i.local}),k=new window.OrderDataLib.CoursesService,j=new window.OrderDataLib.DishesService,J=new window.OrderDataLib.ItemsService({local:i.local})}(e)}var o,H,s,F,q,Y,V,G,X,B,k,j,J,Q,i,W,d;window.OrderDataLib.OrderViewService=(J=j=k=B=X=G=V=Y=q=F=s=H=void 0,Q=!1,i={},W={PaymentTypes:(n(o={OTH:"OTH",CreditCardPayment:"CreditCardPayment",ChargeAccountPayment:"ChargeAccountPayment",CashPayment:"CashPayment",ChequePayment:"ChequePayment"},"CreditCardPayment","CreditCardPayment"),n(o,"ChargeAccountRefund","ChargeAccountRefund"),n(o,"CashRefund","CashRefund"),n(o,"ChequeRefund","ChequeRefund"),n(o,"CreditCardRefund","CreditCardRefund"),o),OrderTypes:{Refund:"Refund",TA:"TA",Delivery:"Delivery",Seated:"Seated",OTC:"OTC"},ReturnTypes:{Cancellation:"cancellation",TransactionBased:"TRANSACTION BASED"},DiscountTypes:{OTH:"OTH"},OfferTypes:{Simple:"Simple",Combo:"Combo",ComplexOne:"Complex-One"},TransTypes:{Reversal:"Reversal",Return:"Return"},Sources:{TabitPay:"tabitPay"},ActionTypes:{kickout:"kickout",resume:"resume",suspend:"suspend"},Resume_Suspend:{manual:"manual",manager:"manager",other:"other"}},d={filterOmittedPayments:function(r){var n=[];r.forEach(function(t){if("omitted"===t.PROVIDER_TRANS_STATUS&&t.CANCELED){var e=r.find(function(e){return!e.CANCELED&&"REFUND"===e.PAYMENT_TYPE&&e.P_AMOUNT===t.P_AMOUNT&&"omitted"===e.PROVIDER_TRANS_STATUS});e&&(n.push(t),n.push(e))}});return 0<n.length&&n.forEach(function(t){var e=r.findIndex(function(e){return e.P_ID===t.P_ID});-1!==e&&r.splice(e,1)}),r},resolveItems:function(e,t){var n=!1;e.RETURN_TYPE===W.ReturnTypes.TransactionBased&&(n=!0);var r=t.ORDERED_OFFERS_LIST;n&&(r=t.RETURNED_OFFERS_LIST);var a=!1;t.EXEMPTED_TAXES&&0<t.EXEMPTED_TAXES.length&&Q&&(a=!0);var o=[],i=[];return r&&0<r.length&&r.forEach(function(e){var t=0;if(t=e.SPLIT_DENOMINATOR&&e.SPLIT_NUMERATOR&&100!==e.SPLIT_DENOMINATOR&&100!==e.SPLIT_NUMERATOR?e.SPLIT_NUMERATOR+"/"+e.SPLIT_DENOMINATOR:e.OFFER_QTY,e.OFFER_TYPE==W.OfferTypes.Simple){var r={isOffer:!0,name:e.OFFER_NAME,qty:t};e.ON_THE_HOUSE?(r.amount=H.getText("OTH"),i.push(r)):(n?(r.amount=s.toFixedSafe(e.OFFER_AMOUNT,2),o.push(r)):0!==e.OFFER_CALC_AMT&&null!==e.OFFER_CALC_AMT&&(r.amount=s.toFixedSafe(e.OFFER_CALC_AMT,2),o.push(r)),e.OPEN_PRICE&&(r.amount=s.toFixedSafe(e.OFFER_AMOUNT,2),o.push(r))),e.ORDERED_OFFER_DISCOUNTS&&0<e.ORDERED_OFFER_DISCOUNTS.length&&e.ORDERED_OFFER_DISCOUNTS.forEach(function(e){o.push({isOfferDiscount:!0,name:e.DISCOUNT_NAME?e.DISCOUNT_NAME:H.getText("MANUAL_ITEM_DISCOUNT"),qty:null,amount:s.toFixedSafe(-1*e.DISCOUNT_AMOUNT,2)})}),e.EXTRA_CHARGE_LIST&&0<e.EXTRA_CHARGE_LIST.length&&e.EXTRA_CHARGE_LIST.forEach(function(e){e.EXTRA_CHARGE_MODIFIERS_LIST&&0<e.EXTRA_CHARGE_MODIFIERS_LIST.length&&e.EXTRA_CHARGE_MODIFIERS_LIST.forEach(function(e){o.push({isItem:!0,name:e.MODIFIER_NAME,qty:null,amount:r.ON_THE_HOUSE?H.getText("OTH"):s.toFixedSafe(e.MODIFIER_PRICE,2)}),e.MODIFIER_DISCOUNTS&&0<e.MODIFIER_DISCOUNTS.length&&e.MODIFIER_DISCOUNTS.forEach(function(e){o.push({isItem:!0,name:e.DISCOUNT_NAME,qty:null,amount:r.ON_THE_HOUSE?H.getText("OTH"):s.toFixedSafe(-1*e.DISCOUNT_AMOUNT,2)})})}),e.ITEM_DISCOUNTS&&0<e.ITEM_DISCOUNTS.length&&e.ITEM_DISCOUNTS.forEach(function(e){o.push({isItem:!0,name:e.DISCOUNT_NAME,qty:null,amount:s.toFixedSafe(-1*e.DISCOUNT_AMOUNT,2)})})})}-1<[W.OfferTypes.ComplexOne,W.OfferTypes.Combo].indexOf(e.OFFER_TYPE)&&(o.push({isOffer:!0,name:e.OFFER_NAME,qty:t,amount:e.ON_THE_HOUSE?H.getText("OTH"):s.toFixedSafe(n?e.OFFER_AMOUNT:e.OFFER_CALC_AMT,2)}),n||e.ORDERED_ITEMS_LIST&&0<e.ORDERED_ITEMS_LIST.length&&e.ORDERED_ITEMS_LIST.forEach(function(e){o.push({isItem:!0,name:e.ITEM_NAME,qty:null,amount:null})}),n||e.EXTRA_CHARGE_LIST&&0<e.EXTRA_CHARGE_LIST.length&&e.EXTRA_CHARGE_LIST.forEach(function(t){t.EXTRA_CHARGE_MODIFIERS_LIST&&0<t.EXTRA_CHARGE_MODIFIERS_LIST.length?t.EXTRA_CHARGE_MODIFIERS_LIST.forEach(function(e){o.push({isItem:!0,name:e.MODIFIER_NAME,qty:null,amount:t.ON_THE_HOUSE?H.getText("OTH"):s.toFixedSafe(t.ITEM_AMOUNT,2)})}):t.ITEM_DISCOUNTS&&0<t.ITEM_DISCOUNTS.length?(o.push({isItem:!0,name:t.ITEM_NAME,qty:null,amount:s.toFixedSafe(t.ITEM_AMOUNT,2)}),t.ITEM_DISCOUNTS&&0<t.ITEM_DISCOUNTS.length&&t.ITEM_DISCOUNTS.forEach(function(e){o.push({isItem:!0,name:e.DISCOUNT_NAME,qty:null,amount:s.toFixedSafe(-1*e.DISCOUNT_AMOUNT,2)})})):o.push({isItem:!0,name:t.ITEM_NAME,qty:null,amount:t.ON_THE_HOUSE?H.getText("OTH"):s.toFixedSafe(t.ITEM_AMOUNT,2)})}),e.ORDERED_OFFER_DISCOUNTS&&0<e.ORDERED_OFFER_DISCOUNTS.length&&e.ORDERED_OFFER_DISCOUNTS.forEach(function(e){o.push({isOfferDiscount:!0,name:e.DISCOUNT_NAME?e.DISCOUNT_NAME:H.getText("MANUAL_ITEM_DISCOUNT"),qty:null,amount:s.toFixedSafe(-1*e.DISCOUNT_AMOUNT,2)})}))}),{items:o,oth:i,isReturnOrder:n,isTaxExempt:a}},resolveTotals:function(e,t){var n=[];if(void 0!==e.TOTAL_SALES_AMOUNT&&(t.ORDER_DISCOUNTS_LIST&&0<t.ORDER_DISCOUNTS_LIST.length||void 0!==e.TOTAL_TIPS||Q&&t.EXCLUSIVE_TAXES&&0<t.EXCLUSIVE_TAXES.length)&&n.push({name:H.getText("TOTAL_ORDER"),amount:s.toFixedSafe(e.TOTAL_SALES_AMOUNT,2)}),t.ORDER_DISCOUNTS_LIST&&0<t.ORDER_DISCOUNTS_LIST.length&&t.ORDER_DISCOUNTS_LIST.forEach(function(e){n.push({name:e.DISCOUNT_NAME?e.DISCOUNT_NAME:H.getText("ORDER_DISCOUNT"),amount:s.toFixedSafe(-1*e.DISCOUNT_AMOUNT,2)})}),t.EXCLUSIVE_TAXES&&0<t.EXCLUSIVE_TAXES.length&&Q&&t.EXCLUSIVE_TAXES.forEach(function(e){n.push({type:"exclusive_tax",name:e.NAME?e.NAME:H.getText("ECVLUSIVE_TAX"),amount:s.toFixedSafe(e.AMOUNT,2),rate:e.RATE})}),t.TIPS){var r=t.TIPS.filter(function(e){return"order"===e.SCOPE});r&&0<r.length&&r&&0<r.length&&Q&&r.forEach(function(e){var t=e.NAME?e.NAME:H.getText("SERVICE_CHARGE"),r=e.PERCENT;void 0!==r&&(t=e.NAME?e.NAME+" "+r+"%":H.getText("SERVICE_CHARGE")+" "+r+"%"),0!==e.AMOUNT&&n.push({type:"service_charge",name:t,amount:s.toFixedSafe(e.AMOUNT,2)})})}if(void 0!==e.TOTAL_TIPS_ON_PAYMENTS||void 0!==e.TOTAL_TIPS){var a=0;void 0!==e.TOTAL_TIPS_ON_PAYMENTS&&0!==e.TOTAL_TIPS_ON_PAYMENTS?a=e.TOTAL_TIPS_ON_PAYMENTS:void 0!==e.TOTAL_TIPS&&0!==e.TOTAL_TIPS&&(a=e.TOTAL_TIPS),0<a&&n.push({type:"tips",name:H.getText("TIP"),amount:s.toFixedSafe(a,2)}),t.PAYMENT_LIST[0].TRANS_TYPE===W.TransTypes.Return&&0!==t.PAYMENT_LIST[0].TIP_AMOUNT&&n.push({type:"tips",name:H.getText("TIP"),amount:s.toFixedSafe(-1*t.PAYMENT_LIST[0].TIP_AMOUNT,2)})}return Q||n.push({name:H.getText("TOTAL_INC_VAT"),amount:s.toFixedSafe(e.TOTAL_IN_VAT||0,2)}),Q&&n.push({name:H.getText("TOTAL_INC_VAT"),amount:s.toFixedSafe(e.TOTAL_AMOUNT||0,2)}),n},resolvePayments:function(e,t){var r=d.filterOmittedPayments(t.PAYMENT_LIST),n=[];return r.forEach(function(e){n.push({name:d.resolvePaymentName(e),amount:e.PAYMENT_TYPE?s.toFixedSafe(-1*e.P_AMOUNT,2):s.toFixedSafe(e.P_AMOUNT,2),holderName:void 0!==e.CUSTOMER_NAME?e.CUSTOMER_NAME:"",md:{payment:e}})}),n.push({type:"change",name:H.getText("CHANGE"),amount:s.toFixedSafe(e.CHANGE,2)}),n},resolveTaxes:function(e,t){var r={InclusiveTaxes:[],ExemptedTaxes:[],ExemptedTaxData:[]};return t.INCLUSIVE_TAXES&&0<t.INCLUSIVE_TAXES.length&&Q&&(r.InclusiveTaxes.push({type:"title",name:H.getText("INCLUSIVE_TAXES")+":",amount:void 0}),t.INCLUSIVE_TAXES.forEach(function(e){r.InclusiveTaxes.push({type:"inclusive_tax",name:e.NAME?e.NAME:H.getText("INCLUSIVE_TAXES"),amount:s.toFixedSafe(e.AMOUNT,2)})})),t.EXEMPTED_TAXES&&0<t.EXEMPTED_TAXES.length&&Q&&(r.ExemptedTaxes.push({type:"title",name:H.getText("EXEMPTED_TAXES")+":",amount:void 0}),t.EXEMPTED_TAXES.forEach(function(e){r.ExemptedTaxes.push({type:"exempted_tax",name:e.NAME?e.NAME:H.getText("EXEMPTED_TAX"),amount:s.toFixedSafe(e.AMOUNT,2)})})),r},resolvePaymentName:function(e){var t="";return"REFUND"===e.PAYMENT_TYPE&&(t=e.TRANS_TYPE===W.TransTypes.Reversal?H.getText("REVERSAL"):e.TRANS_TYPE===W.TransTypes.Return?H.getText("RETURN"):H.getText("REFUND")),"creditCard"===e.P_TENDER_TYPE||"gidtCard"===e.P_TENDER_TYPE?""!==t?t+" ("+e.CARD_TYPE+" "+e.LAST_4+")":e.CARD_TYPE+" "+e.LAST_4:t+" "+e.P_NAME},resolvePrintByOrder:function(e){return H.getText("PRINT_BY_ORDER",["order_number","order_date","order_time"],[e.ORDER_NO,Q?F(e.CREATED_AT).format("MM/DD/YYYY"):F(e.CREATED_AT).format("DD/MM/YYYY"),Q?F(e.CREATED_AT).format("h:mm:ss A"):F(e.CREATED_AT).format("HH:mm:ss")])},resolveWaiterDiners:function(e){var t="";void 0!==e.F_NAME&&(t+=e.F_NAME),void 0!==e.L_NAME&&(t+=" "+e.L_NAME[0]);void 0!==e.TABLE_NO&&e.TABLE_NO;var r="";return r+=H.getText("WAITER_DINERS",["waiter","diners"],[""+t,e.NUMBER_OF_GUESTS])}},a.prototype.TimeLine={enrichOrder:function(e){e.tlogId;var t,r,n,a,o,i,s,u,d,c,T,E,l,f,m,p,O=e.tlog,v=(e.status,e.tables),S=e.items,R=e.users,h=e.promotions,I=e.modifierGroups,y={},A=O,D={Tables:v,Items:S,Users:R,Offers:e.offers,Promotions:h,AllModifiers:I};(y=void 0===(t=A).order?t:t.order[0]).tlogId=(r=A).id||r._id,y.totalCashback=(n=y.payments,a=0,n.forEach(function(e){a+=_.has(e,"auxAmount")?e.auxAmount:0}),a?a/100:0),y.dinersNum=y.diners.length,y.totalAmount=A.totalAmount/100,y.closed=y.closed,y.hasQuantitySale=(o=!1,y.orderedOffers.forEach(function(e){e.quantitySaleId&&(o=!0)}),o),y.courier=(i=y,G.resolveUser({userId:i.courier,users:D.Users})),y.businessDateToDisplay=(s=A,_.get(s,"order[0]"),s.businessDate),y.changeOfBD=(u=A,d=y.businessDateToDisplay,!!_.get(u,"order[0]")&&F(_.get(u,"order[0].businessDate")).valueOf()!==F(d).valueOf()),y.deliveryNotes=(c=y.deliveryNotes,T=y.tlogId,c&&c.forEach(function(e){e.tlogId=T,e.payments&&(e.cardNum=e.payments[0].cardNum,e.providerTransactionId=void 0===e.payments[0].providerTransactionId?"":e.payments[0].providerTransactionId,e.payments[0].providerResponse&&(e.companyName=void 0===e.payments[0].providerResponse.companyName?"":e.payments[0].providerResponse.companyName))}),c),y.invoices=(E=y.invoices,l=y.tlogId,E&&E.forEach(function(e){e.tlogId=l,e.payments&&e.payments[0]._type===W.PaymentTypes.CreditCardPayment&&(e.confirmationNum=void 0===e.payments[0].confirmationNum?"":e.payments[0].confirmationNum,e.issuerName=_.get(e,"payments[0].issuer.name")?e.payments[0].issuer.name:"",e.payments[0].providerResponse&&(e.last4=e.payments[0].providerResponse.Last4,e.CCType=e.payments[0].providerResponse.CCType,e.transId=e.payments[0].providerResponse.TransID))}),E),y.waiter=G.resolveUserName({userId:y.openedBy,users:D.Users}),y.owner=G.resolveUser({userId:y.owner,users:D.Users}),y.openedBy=G.resolveUser({userId:y.openedBy,users:D.Users}),y.lockedBy=G.resolveUser({userId:y.lockedBy,users:D.Users}),y.clubMembers=(m=[],(f=y).diners.length&&(m=_.chain(f.diners).filter(function(e){if(e.member)return e}).map(function(e){return{firstName:e.member.firstName,lastName:e.member.lastName,phone:e.member.phone}}).value()),m),y.orderTypeDisplayText=(p=y.orderType,H.getText("ORDER_TYPES_"+p.toUpperCase()));var N,C,P,g,U,M=(C=(N=y).orderedOffers,P=N.orderedItems,g=N.orderedDiscounts,U=[],C&&C.forEach(function(s){if(!s.cancellation){var e={name:s.name,price:s.price,_id:s._id};s.onTheHouse&&(e.onTheHouse=H.getText("OTH")),U.push(e),s.orderedItems.forEach(function(r){var e,t,n=P.find(function(e){return e._id===r}),a=g.find(function(e){return e.target===r._id});if(a&&(n.discount=a),n.price||(n.price=0),n.item=D.Items.find(function(e){return e._id===n.item}),n.item&&(n.item.price=n.price,U.push(n.item)),n.selectedModifiers=(e=n.selectedModifiers,t=[],e.forEach(function(e){t.push(e)}),t),n.selectedModifiers){n.selectedModifiers.forEach(function(e){var t=g.find(function(e){return e.target===r._id});t&&(e.discount=t),U.push({name:e.name,price:e.price,type:"modifier",_id:e._id})});var o=[];n.selectedModifiers&&n.selectedModifiers.forEach(function(e){o.push(e)}),s.notDefaultSelectedModifiers=o;var i=[];n.removedModifiers&&n.removedModifiers.forEach(function(e){i.push(e)}),s.allRemovedModifiers=i}}),s.offer=(t=s.offer,D.Offers.find(function(e){return e._id===t}))}var t}),{items:U,orderedOffers:C});y.orderedOffers=M.orderedOffers,y.items=M.items,y.paymentName=X.resolvePaymentNames(y),y.payments=X.resolvePaymentsAmount(y),y.table=B.resolveTable(y,{tables:D.Tables});var L=q.resolveTotalDiscount(y);y.totalDiscount=L.totalDiscount,y.totalDiscountName=L.totalDiscountName,y.promotions=Y.resolvePromotions(y,{promotions:D.Promotions}),y.promotionsCollection=Y.resolvePromotionsCollection(y.promotions,y.orderedPromotions),y.discounts=q.resolveDiscounts(y),y.discountsCollection=q.resolveDiscountsCollection(y.discounts),y.dishes=j.resolveDishes(y),y.courses=k.resolveCourses(y,{users:D.Users}),y.cencelledItems=J.resolveCencelledItems(y,{users:D.Users}),y.unasignedItems=J.resolveUnasignedItems(y,{users:D.Users}),y.timeline=V.resolveTimeLine(y,{users:R});var x,w=(x=[],y.payments.forEach(function(e){x.push(new b(e))}),x);function b(e){this.methodName=e.methodName,this.creditCardBrand=e.creditCardBrand,this.customerName=e.customerDetails?e.customerDetails.name:"",this.last4="xxxx"!==e.last4?e.last4:"",this.amount=e.amount,this.faceValue=e.faceValue,this.quantity=e.auxIntent?e.auxIntent.quantity:"",this.creditAccountName=e.accountName,Q?(this.tipAmount=e.change?e.change.amount:"",this.quantity=e.auxIntent?e.auxIntent.quantity:""):-1<[W.PaymentTypes.CreditCardPayment,W.PaymentTypes.ChequePayment].indexOf(e._type)?this.tipAmount=e.cashback?e.cashback.amount:"":this.tipAmount=e.change?e.change.amount:"",e.source===W.Sources.TabitPay&&(this.source="(Tabit Pay)")}return y.PaymentsTimeLine=w,y}},a.prototype.Bill={resolveBillCheck:function(e){var t=e.printData.collections,r=e.printData.variables;if(0!==t.PAYMENT_LIST.length){var n={},a=d.resolveItems(r,t);n.items=a.items,n.oth=a.oth,n.isReturnOrder=a.isReturnOrder,n.isTaxExempt=a.isTaxExempt;var o=d.resolveTotals(r,t,!0);n.totals=o;var i=d.resolvePayments(r,t,!0);n.payments=i;var s=d.resolveTaxes(r,t,!0);return n.taxes=s,new function(e,t,r,n,a){this.collections=e,this.variables=t,this.data=r,this.print_by_order=n,this.waiter_diners=a}(t,r,n,d.resolvePrintByOrder(r),d.resolveWaiterDiners(r))}},resolveBillData:function(e,t){var r=e.printData.collections,n=e.printData.variables,a={},o=d.resolveItems(n,r);a.items=o.items,a.oth=o.oth,a.isReturnOrder=o.isReturnOrder,a.isTaxExempt=o.isTaxExempt;var i=d.resolveTotals(n,r,!0);a.totals=i;var s=d.resolvePayments(n,r,!0);a.payments=s;var u=d.resolveTaxes(n,r,!0);return a.taxes=u,a.isUS=t,new function(e,t,r,n,a){this.collections=e,this.variables=t,this.data=r,this.print_by_order=n,this.waiter_diners=a}(r,n,a,d.resolvePrintByOrder(n),d.resolveWaiterDiners(n))}},a)},function(e,t,r){"use strict";function n(e){var t;(t=e).local&&(o.local=t.local)}var a,o;window.OrderDataLib.TranslateService=(a={"en-US":{OTH:"OTH",MANUAL_ITEM_DISCOUNT:"Manual Discount",TOTAL_ORDER:"Subtotal",ORDER_DISCOUNT:"Order Discount",ECVLUSIVE_TAX:"Exclusive Tax",SERVICE_CHARGE:"Service Charge",TIP:"Tip",TOTAL_INC_VAT:"Check Total",CHANGE:"Change",INCLUSIVE_TAXES:"Inclusive Taxes",EXEMPTED_TAXES:"Exempted Taxes",EXEMPTED_TAX:"Tax Exempt",REVERSAL:"Reversal",RETURN:"Return",REFUND:"Refund",PRINT_BY_ORDER:"Order {{order_number}} on {{order_date}} {{order_time}}",WAITER_DINERS:"Server {{waiter}} Diners {{diners}}",TABLE_NUM:"Table {{table}}",TA:"TA",DELIVERY:"Delivery",INITIATED_DISCOUNT:"Initiated.D",CANCEL:"Cancel",CUSTOMER_NAME:"Name",LAST_4:"Last 4 Digits",AMOUNT:"Amount",CHARGE_ACCOUNT:"Charge Account",CASH:"Cash",GIFT_CARD:"Gift Card",GIFT_CARD_LOAD:"Charge Gift Card",CHEQUE:"Cheque",CREDIT:"Credit",CHARGE_ACCOUNT_REFUND:"Charge account refund",CASH_REFUND:"Cash Refund",CHEQUE_REFUND:"Cheque Refund",CREDIT_REFUND:"Credit Refund",OPEN:"Open",ORDER:"Order",CLOSE:"Close",PAYMENT:"Payment",APPROVED:"Approved",OTH_ORDER_APPLIED:"Order OTH Requested",OTH_ORDER_APPROVED:"Order OTH Approved",OTH_ITEM_APPLIED:"Item OTH Requested",OTH_ITEM_APPROVED:"Item OTH Approved",CANCEL_ITEM_APPLIED:"Cancel Item Requested",CANCEL_ITEM_APPROVED:"Cancel Item Approved",RETURN_ITEM_APPLIED:"Return Item Requested",RETURN_ITEM_APPROVED:"Return Item Approved",PERCENT_OFF_ORDER:"% Off Order",AMOUNT_OFF_ORDER:" Off Order",PERCENT_OFF_ITEM:"% Off Item",APPLIED_SEGMENTATION:"Tag Applied",APPROVED_SEGMENTATION:"Tag Approved",ORDER_TYPES_SEATED:"Seated",ORDER_TYPES_TA:"TA",ORDER_TYPES_DELIVERY:"Delivery",ORDER_TYPES_REFUND:"Refund",ORDER_TYPES_OTC:"OTC",ORDER_TYPES_MEDIAEXCHANGE:"Media Exchange",OTH_TYPE_COMPENSATION:"Compensation",OTH_TYPE_CONSERVATION:"Conservation",OTH_TYPE_ORGANIZATIONAL:"Staff",SUSPEND_MANUAL:"Tehchnical Support",SUSPEND_MANAGER:"Manual",RESUME:"Resume",SUSPEND:"Suspend"},"he-IL":{OTH:"על חשבון הבית",MANUAL_ITEM_DISCOUNT:"הנחה יזומה",TOTAL_ORDER:'סה"כ הזמנה',ORDER_DISCOUNT:"הנחת חשבון",ECVLUSIVE_TAX:"מס שנוסף להזמנה",SERVICE_CHARGE:"Service Charge",TIP:"תשר",TOTAL_INC_VAT:'סה"כ לתשלום',CHANGE:"עודף",INCLUSIVE_TAXES:"Inclusive Taxes",EXEMPTED_TAXES:"Exempted Taxes",EXEMPTED_TAX:"Tax Exempt",REVERSAL:"ביטול",RETURN:"החזרה",REFUND:"החזר",PRINT_BY_ORDER:"לפי הזמנה מס' {{order_number}} בתאריך {{order_date}} בשעה {{order_time}}",WAITER_DINERS:"מלצר {{waiter}} סועדים {{diners}}",TABLE_NUM:"שולחן {{table}}",TA:"TA",DELIVERY:"משלוחים",INITIATED_DISCOUNT:"הנחה יזומה",CANCEL:"ביטול",CUSTOMER_NAME:"שם",LAST_4:"4 ספרות",AMOUNT:"סכום",CHARGE_ACCOUNT:"הקפה",CASH:"מזומן",GIFT_CARD:"כרטיס תשלום",GIFT_CARD_LOAD:"טעינת כרטיס תשלום",CHEQUE:"המחאה",CREDIT:"אשראי",CHARGE_ACCOUNT_REFUND:"החזר הקפה",CASH_REFUND:"החזר מזומן",CHEQUE_REFUND:"החזר המחאה",CREDIT_REFUND:"החזר אשראי",OPEN:"פתיחה",ORDER:"הזמנה",CLOSE:"סגירה",PAYMENT:"תשלום",APPROVED:"אושר",OTH_ORDER_APPLIED:"בקשה ל-OTH חשבון",OTH_ORDER_APPROVED:"אישור OTH חשבון",OTH_ITEM_APPLIED:"בקשה ל-OTH פריט",OTH_ITEM_APPROVED:"אישור OTH פריט",CANCEL_ITEM_APPLIED:"בקשה לביטול פריט",CANCEL_ITEM_APPROVED:"אישור ביטול פריט",RETURN_ITEM_APPLIED:"בקשה להחזרת פריט",RETURN_ITEM_APPROVED:"אישור החזרת פריט",PERCENT_OFF_ORDER:"% הנחת הזמנה",AMOUNT_OFF_ORDER:" הנחת סכום הזמנה",PERCENT_OFF_ITEM:"% הנחת פריט",APPLIED_SEGMENTATION:"בקשה לתיוג",APPROVED_SEGMENTATION:"אישור תיוג",ORDER_TYPES_SEATED:"ישיבה",ORDER_TYPES_TA:" TA",ORDER_TYPES_DELIVERY:"משלוח",ORDER_TYPES_REFUND:"החזר",ORDER_TYPES_OTC:"דלפק (OTC)",ORDER_TYPES_MEDIAEXCHANGE:"טעינת כרטיס",OTH_TYPE_COMPENSATION:"פיצוי לקוחות",OTH_TYPE_CONSERVATION:"שימור לקוחות",OTH_TYPE_ORGANIZATIONAL:"עובדים",SUSPEND_MANUAL:"צוות טכני",SUSPEND_MANAGER:"ידנית",SUSPEND_OTHER:"ספק תשלום לא זמין",RESUME:"חזרה מהשהייה",SUSPEND:"השהיית הזמנה"}},o={},n.prototype.getText=function(e,t,r){if(void 0===e)return"Missing Key";var n=a[o.local][e];return void 0!==n?(void 0!==t&&void 0!==r&&0<t.length&&0<r.length&&t.forEach(function(e,t){n=n.replace("{{"+e+"}}",r[t])}),n):"["+e+"]"},n)},function(e,t,r){"use strict";function n(){}function a(e,t){return null!=e?e.toFixed(t):"--"}window.OrderDataLib.Utils=(n.prototype.toFixedSafe=a,n.prototype.currencyFraction=function(e,t){if(!t||e&&!isNaN(e)||(e=0),!isNaN(e)){var r=a(e/100,2);return parseFloat(r)}},n.prototype.groupBy=function(e,r){return e.reduce(function(e,t){return(e[t[r]]=e[t[r]]||[]).push(t),e},{})},n.prototype.uniqBy=function(e,r){var n=[];return e.forEach(function(t){if(r&&void 0!==t[r]){var e=n.find(function(e){return e[r]===t[r]});void 0===e?(t.qty=1,n.push(t)):e.qty++}}),n},n)},function(e,t,r){"use strict";function n(e){new window.OrderDataLib.Utils}window.OrderDataLib.UserService=(n.prototype.resolveUserName=function(e){var t=e.userId,r=e.users;if(r&&0<r.length){var n=r.find(function(e){return e._id===t});if(n)return n.firstName+" "+n.lastName}return"None"},n.prototype.resolveUser=function(e){var t=e.userId,r=e.users,n=void 0;return r&&0<r.length&&(n=r.find(function(e){return e._id===t})),n?n.displayName=function(e){var t=e.user,r="";return void 0!==t.firstName&&(r+=t.firstName),void 0!==t.lastName&&(r+=" "+t.lastName[0]),r}({user:n}):console.log("missing users"),n},n)},function(e,t,r){"use strict";function n(e){new window.OrderDataLib.Utils,l=new window.OrderDataLib.TranslateService({local:e.local}),o=new window.OrderDataLib.PaymentsService({local:e.local}),f=new window.OrderDataLib.UserService,m=new window.OrderDataLib.OthService({local:e.local}),a=new window.OrderDataLib.DiscountsService({local:e.local}),i=new window.OrderDataLib.SegmentationsService({local:e.local}),s=new window.OrderDataLib.HistoriesService({local:e.local})}var l,o,f,m,a,i,s,c,p,O,v,u,d,T,E,S,R,h,I,y,A;window.OrderDataLib.TimeLineService=(s=i=a=m=f=o=l=void 0,c=["notified","fired","served","prepared","taken"],p="transfer",O=function(e){if(_.isEmpty(e))return"";if(0!==e.indexOf("Transfering items"))return e;var t=e.split(" ")[4];return l.getText("TRANSFERING_ITEMS_TO_TABLE",["table"],[t])},v={isTransferItem:function(e,t){return"transfer"===_.get(t,"cancellation.reason.returnType")},isRefundOrder:function(e){return-1<_.get(e,"payments[0]._type","").toUpperCase().indexOf("refund".toUpperCase())}},u=function(e){var t=l.getText("OPEN"),r=v.isRefundOrder(e);return"Seated"!==e.orderType||0!==e.tableIds.length||r||(t="Open Tab"),{action:t,data:l.getText("ORDER"),at:e.created,by:e.waiter}},d=function(e){return{action:l.getText("CLOSE"),data:l.getText("ORDER"),at:e.closed,by:""}},T=function(e){var a=[],s=e.orderedItems,u=e.orderedOffers,d=e.cancelledOffers;return e.courses.forEach(function(r){var n=function(n){var a=[],o={};if(void 0===n||0===n.length)return a;if(u.concat(d).forEach(function(t){var r=n.find(function(e){return e===_.get(t,"orderedItems[0]")}),e=void 0;(r=r||n.find(function(e){return e===_.get(t,"cancelledItems[0]")}))&&(e=s.find(function(e){return e._id===r})),e&&(delete e.qty,t.quantitySaleId?(void 0===o[t.quantitySaleId]&&(o[t.quantitySaleId]=[]),o[t.quantitySaleId].push(e)):a.push(e))}),void 0!==o)for(var e in o)if(o.hasOwnProperty(e)){var t=o[e],r=t.length,i=t[0];i.qty=r,a.push(i)}return a}(r.orderedItems).map(function(e){return e.qty&&1<e.qty?e.name+" "+e.qty+"x":""+e.name});c.forEach(function(e){if(_.has(r,e)&&r[e]){var t="";r.courseType&&(t=r.courseType.toUpperCase()),a.push({action:e+" "+l.getText(t),data:JSON.parse(JSON.stringify(n)).filter(function(e){return void 0!==e}).join(",  "),at:r[e].at,by:r[e].waiter})}})}),a},E=function(e,t){var r=t.users,n=e.payments,a=[];return n.forEach(function(e){a.push({action:l.getText("PAYMENT"),data:o.resolvePaymentData(e),at:e.lastUpdated,by:f.resolveUserName({userId:e.user,users:r}),recordType:"payment"})}),a},S=function(e,t){var n=t.users,r=e.payments,a=[];return r.forEach(function(e){var t=!1,r=void 0;e.approved&&(r=e.approved,t=!0),t&&a.push({action:l.getText("APPROVED"),data:o.resolvePaymentData(e),at:r.at,by:f.resolveUserName({userId:r.by,users:n}),isApproved:t})}),a},R=function(o,e){var i=e.users,t=o.orderedItems,s=JSON.parse(JSON.stringify(o.orderedOffers)),r=o.cancelledOffers,u=[],n=[],a={};if(t.forEach(function(t){var e=s.find(function(e){return t._id===_.get(e,"orderedItems[0]")});(e=e||r.find(function(e){return t._id===_.get(e,"cancelledItems[0]")}))&&(e.quantitySaleId?(void 0===a[e.quantitySaleId]&&(a[e.quantitySaleId]=[]),a[e.quantitySaleId].push(t)):n.push(t))}),void 0!==a)for(var d in a)if(a.hasOwnProperty(d)){var c=a[d],T=c.length,E=c[0];E.qty=T,n.push(E)}return n.forEach(function(t){var e=s.find(function(e){return _.get(e,"offer._id")===t.offer});if(t.cancellation){var r="";_.get(t,"cancellation.reason.returnType")===p?r=l.getText("TRANSFER"):t.cancellation.reason&&(r=t.cancellation.reason.name);var n=r;if(t.cancellation.comment&&(n+=": "+O(t.cancellation.comment)),t.cancellation.reason&&"cancellation"==t.cancellation.reason.returnType)u.push({qty:t.qty,action:l.getText("CANCEL_ITEM_APPLIED"),name:t.name,data:n,at:_.get(t,"cancellation.applied.at"),by:f.resolveUserName({userId:_.get(t,"cancellation.applied.by"),users:i})}),t.cancellation.approved&&u.push({qty:t.qty,action:l.getText("CANCEL_ITEM_APPROVED"),name:t.name,data:n,at:_.get(t,"cancellation.approved.at"),by:f.resolveUserName({userId:_.get(t,"cancellation.approved.by"),users:i})});else{var a=v.isTransferItem(n,t);u.push({qty:t.qty,action:a?l.getText("TRANSFER_ITEM_APPLIED"):l.getText("RETURN_ITEM_APPLIED"),name:t.name,data:n,at:_.get(t,"cancellation.applied.at"),by:f.resolveUserName({userId:_.get(t,"cancellation.applied.by"),users:i})}),t.cancellation.approved&&u.push({qty:t.qty,action:a?l.getText("TRANSFER_ITEM_APPROVED"):l.getText("RETURN_ITEM_APPROVED"),name:t.name,data:n,at:_.get(t,"cancellation.approved.at"),by:f.resolveUserName({userId:_.get(t,"cancellation.approved.by"),users:i})})}}else if(t.onTheHouse&&!o.onTheHouse&&void 0===t.cancellation){m.resolveItemOTH(t,{onTheHouse:t.onTheHouse||e.onTheHouse,order:o,users:i}).forEach(function(e){return u.push(e)})}}),m.resolveOrderOTH(o,{users:i}).forEach(function(e){u.push(e)}),u},h=function(e,t){return a.resolveDiscountsTimeLine(e,{users:t.users})},I=function(e,t){return i.resolveSegmentationsTimeLine(e,{users:t.users})},y=function(e,t){return s.resolveHistoriesToTimeLine(e,{users:t.users})},A=function(e,t){var r=[];return"Delivery"===e.orderType&&e.delivered&&r.push({action:l.getText("DELIVERED"),data:l.getText("ORDER"),at:e.delivered.at,by:f.resolveUserName({userId:e.delivered.by,users:t.users})}),r},n.prototype.resolveTimeLine=function(e,t){var r=t.users,n=[];return n.push(u(e)),n.push(d(e)),T(e).forEach(function(e){n.push(e)}),E(e,{users:r}).forEach(function(e){n.push(e)}),S(e,{users:r}).forEach(function(e){n.push(e)}),R(e,{users:r}).forEach(function(e){n.push(e)}),h(e,{users:r}).forEach(function(e){return n.push(e)}),I(e,{users:r}).forEach(function(e){return n.push(e)}),y(e,{users:r}).forEach(function(e){return n.push(e)}),A(e,{users:r}).forEach(function(e){return n.push(e)}),n=_.sortBy(n,"at")},n)},function(e,t,r){"use strict";function n(e){s=new window.OrderDataLib.TranslateService({local:e.local})}var s,u,d,c;window.OrderDataLib.TableService=(s=void 0,u="Refund",d="TA",c="Delivery",n.prototype.resolveTable=function(e,t){var r=e.orderType,n=e.tableIds,a=t.tables,o="";if(r===u)o=s.getText("REFUND");else if(r===d)o=s.getText("TA");else if(r===c)o=s.getText("DELIVERY");else if(a&&0<a.length){var i=a.find(function(e){return e._id===n[0]});o=i?i.number:""}return o},n)},function(e,t,r){"use strict";function n(e){i=new window.OrderDataLib.TranslateService({local:e.local}),s=new window.OrderDataLib.UserService}var i,s;window.OrderDataLib.SegmentationsService=(s=i=void 0,n.prototype.resolveSegmentationsTimeLine=function(e,t){var r=t.users,n=e.segmentations,a=e.diners,o=[];return 0<n.length&&n.forEach(function(e){e.applied&&o.push({action:i.getText("APPLIED_SEGMENTATION"),data:e.name,at:e.applied.at,by:s.resolveUserName({userId:_.get(e,"applied.by"),users:r})}),e.approved&&o.push({action:i.getText("APPROVED_SEGMENTATION"),data:e.name,at:e.approved.at,by:s.resolveUserName({userId:_.get(e,"approved.by"),users:r})})}),0<a.length&&a.forEach(function(e){e.segmentations&&e.segmentations.forEach(function(e){e.applied&&o.push({action:i.getText("APPLIED_SEGMENTATION"),data:e.name,at:e.applied.at,by:s.resolveUserName({userId:_.get(e,"applied.by"),users:r})}),e.approved&&o.push({action:i.getText("APPROVED_SEGMENTATION"),data:e.name,at:e.approved.at,by:s.resolveUserName({userId:_.get(e,"approved.by"),users:r})})})}),o},n)},function(e,t,r){"use strict";function n(e){l=new window.OrderDataLib.Utils}var l;window.OrderDataLib.PromotionsService=(l=void 0,n.prototype.resolvePromotions=function(e,t){var r=t.promotions,n=function(e,r){var n=[],a=[];return e.forEach(function(e){var t=e.promotion;r.find(function(e){return e._id===t})?n.push(e):a.push(e)}),{inOrderedDiscounts:n,outOrderedDiscounts:a}},a=function(e,n){return e.forEach(function(e){var t=_.get(e,"discount.rewardedResources[0].orderedOffer");void 0===t&&(t=_.get(e,"discount.discountApportionment[0].resource.orderedOffer"));var r=n.find(function(e){return e._id===t});e.md={offer:r}}),e},o=function(e){var t=e.inOrderedDiscounts,r=e.outOrderedDiscounts,n={};return t.forEach(function(e){var t=_.get(e,"md.offer.quantitySaleId")?e.md.offer.quantitySaleId:null;void 0!==t&&(n.hasOwnProperty(t)||(n[t]=[]),n[t].push(e))}),r.forEach(function(e){var t=_.get(e,"md.offer.quantitySaleId")?e.md.offer.quantitySaleId:null;void 0!==t&&(n.hasOwnProperty(t)||(n[t]=[]),n[t].push(e))}),n},i=JSON.parse(JSON.stringify(e.rewards)),s=e.orderedOffers,u=n(i,e.orderedDiscounts);u.inOrderedDiscounts=a(u.inOrderedDiscounts,s),u.outOrderedDiscounts=a(u.outOrderedDiscounts,s);var d=o({inOrderedDiscounts:u.inOrderedDiscounts,outOrderedDiscounts:u.outOrderedDiscounts});for(var c in d)if(d.hasOwnProperty(c)){var T=d[c];d[c]=l.uniqBy(T,"promotion"),d[c]=d[c].filter(function(t){var e=r.find(function(e){return e._id===t.promotion});if(void 0!==e)return t.md.promotion=e,t})}var E=_.union(Object.values(d));return[].concat.apply([],E)},n.prototype.resolvePromotionsCollection=function(e,a){var o=[];return e.forEach(function(e){var t=0;e.qty&&_.get(e,"discount.amount")&&(t=e.qty*e.discount.amount);var r=_.get(e,"md.promotion._id"),n=a.find(function(e){return e.promotion===r});o.push({qty:e.qty,name:e.name,amount:_.get(e,"discount.amount")||"",totalAmount:t,redeemCode:_.get(n,"redeemCode")})}),o},n)},function(e,t,r){"use strict";function n(e){d=new window.OrderDataLib.Utils,u=new window.OrderDataLib.TranslateService({local:e.local}),new window.OrderDataLib.UserService}function s(e){var t=e.key,r=e.addSpace,n=e.addChar,a={oth:u.getText("OTH"),ChargeAccountPayment:u.getText("CHARGE_ACCOUNT"),CashPayment:u.getText("CASH"),GiftCard:u.getText("GIFT_CARD"),GiftCardLoad:u.getText("GIFT_CARD_LOAD"),ChequePayment:u.getText("CHEQUE"),CreditCardPayment:u.getText("CREDIT"),ChargeAccountRefund:u.getText("CHARGE_ACCOUNT_REFUND"),CashRefund:u.getText("CASH_REFUND"),ChequeRefund:u.getText("CHEQUE_REFUND"),CreditCardRefund:u.getText("CREDIT_REFUND")},o="";return"CreditCardPayment"===t?o="":(o=a[t],void 0===n&&(n="-"),r&&(o+=" "+n+" ")),o}var u,d,c,T;window.OrderDataLib.PaymentsService=(d=u=void 0,c={OTH:"OTH",CreditCardPayment:"CreditCardPayment",ChargeAccountPayment:"ChargeAccountPayment",CashPayment:"CashPayment",ChequePayment:"ChequePayment",ChargeAccountRefund:"ChargeAccountRefund",CashRefund:"CashRefund",ChequeRefund:"ChequeRefund",CreditCardRefund:"CreditCardRefund"},T={TabitPay:"tabitPay"},n.prototype.resolvePayments=function(e){},n.prototype.resolvePaymentData=function(e){var t=[];return function(e){var t=[],r=[],n=s({key:e._type,addSpace:!0,addChar:":"});if(""!==n&&r.push(n),e._type===c.CreditCardPayment||e._type===c.CreditCardRefund){if(e.creditCardBrand&&""!==e.creditCardBrand){var a=e.creditCardBrand;r.push(a)}}else e._type!==c.ChargeAccountPayment&&e._type!==c.ChargeAccountRefund||e.accountName&&""!==e.accountName&&(r.push(e.accountName),e.accountName);if(e.last4&&""!==e.last4&&"xxxx"!==e.last4&&(r.push(e.last4),e.last4),0<r.length){var o="";r.forEach(function(e){return o+="  "+e}),t.push({value:o})}var i=d.toFixedSafe(d.currencyFraction(e.amount),2);return t.push({key:u.getText("AMOUNT"),value:i}),e.customerDetails&&e.customerDetails.name&&""!==e.customerDetails.name&&t.push({key:u.getText("CUSTOMER_NAME"),value:e.customerDetails.name}),e._type!==c.CreditCardPayment&&e._type!==c.CreditCardRefund||e.source!==T.TabitPay||t.push({key:"source",value:"(Tabit Pay)"}),t}(e).forEach(function(e){return t.push(e)}),t},n.prototype.resolvePaymentNames=function(e){function t(e,t){-1===e.indexOf(t)&&e.push(t)}var r=[],n=e.payments;return n&&(e.onTheHouse?r.push(c.OTH):n.forEach(function(e){switch(e._type){case c.ChargeAccountPayment:t(r,c.ChargeAccountPayment);break;case c.CashPayment:t(r,c.CashPayment);break;case c.ChequePayment:t(r,c.ChequePayment);break;case c.CreditCardPayment:t(r,c.CreditCardPayment);break;case c.CashRefund:t(r,c.CashRefund);break;case c.ChequeRefund:t(r,c.ChequeRefund);break;case c.CreditCardRefund:t(r,c.CreditCardRefund)}})),r.join("+")},n.prototype.resolvePaymentsAmount=function(e){var t=e.payments;return t.forEach(function(e){e.name=e._type,void 0!==e.customerDetails&&(e.holderName=void 0!==e.customerDetails.name?e.customerDetails.name:""),e._type!==c.CreditCardRefund&&e._type!==c.ChargeAccountRefund&&e._type!==c.CashRefund&&e._type!==c.ChequeRefund&&e._type!==c.CreditCardRefund||(e.amount*=-1),e.methodName=s({key:e._type,addSpace:!1}),e.methodName+=" ",e._type===c.ChargeAccountPayment&&(e.methodName+=e.accountName),e._type===c.ChequeRefund&&(e.accountName="cheque_refund")}),t},n)},function(e,t,r){"use strict";function n(e){i=new window.OrderDataLib.TranslateService({local:e.local}),s=new window.OrderDataLib.UserService}var i,s;window.OrderDataLib.OthService=(s=i=void 0,n.prototype.resolveOrderOTH=function(e,t){var r=t.users,n=[],a=void 0;return e.onTheHouse&&(a=e.onTheHouse.reason.name,e.onTheHouse.comment&&(a+=": "+e.onTheHouse.comment),n.push({action:i.getText("OTH_ORDER_APPLIED"),data:a,at:e.onTheHouse.applied.at,by:s.resolveUserName({userId:_.get(e,"onTheHouse.applied.by"),users:r})}),e.onTheHouse.approved&&n.push({action:i.getText("OTH_ORDER_APPROVED"),data:a,at:e.onTheHouse.approved.at,by:s.resolveUserName({userId:_.get(e,"onTheHouse.approved.by"),users:r})})),n},n.prototype.resolveItemOTH=function(e,t){t.order;var r=t.onTheHouse,n=t.users,a=[],o="";return r&&r.reason&&r.reason.name&&(o+=""+r.reason.name),r&&r.comment&&(o+=" : "+r.comment),r.applied&&a.push({qty:e.qty,action:i.getText("OTH_ITEM_APPLIED"),name:e.name,data:o,at:r.applied?r.applied.at:"",by:s.resolveUserName({userId:_.get(r,"applied.by"),users:n})}),r.approved&&a.push({qty:e.qty,action:i.getText("OTH_ITEM_APPROVED"),name:e.name,data:o,at:r.approved?r.approved.at:"",by:s.resolveUserName({userId:_.get(r,"approved.by"),users:n})}),a},n)},function(e,t,r){"use strict";function n(e){T=new window.OrderDataLib.UserService,E=new window.OrderDataLib.TranslateService({local:e.local})}var T,E,l,f;window.OrderDataLib.ItemsService=(E=T=void 0,l={Cancellation:"cancellation",TransactionBased:"TRANSACTION BASED",Transfer:"transfer"},f=function(e){if(_.isEmpty(e))return"";if(0!==e.indexOf("Transfering items"))return e;var t=e.split(" ")[4];return E.getText("TRANSFERING_ITEMS_TO_TABLE",["table"],[t])},n.prototype.resolveCencelledItems=function(e,t){var r=t.users,n=[],a={},o=e.cancelledOffers,i=e.orderedItems;if(o.forEach(function(t){var e=i.find(function(e){return e._id===_.get(t,"cancelledItems[0]")});e&&e.cancellation&&(e.cancellation.applied&&(e.cancellation.applied.user=T.resolveUserName({userId:_.get(e,"cancellation.applied.by"),users:r})),e.cancellation.approved&&(e.cancellation.approved.user=T.resolveUserName({userId:_.get(e,"cancellation.approved.by"),users:r})),e.cancellation.reason?(e.cancellation.reason.returnType===l.Cancellation?e.displayReturnType=E.getText("CANCEL"):e.cancellation.reason.returnType===l.Transfer?e.displayReturnType=E.getText("TRANSFER"):e.displayReturnType=E.getText("RETURN"),e.cancellation.text=f(e.cancellation.comment)):console.log("reason object id missing"),t.quantitySaleId?(void 0===a[t.quantitySaleId]&&(a[t.quantitySaleId]=[]),a[t.quantitySaleId].push(e)):n.push(e))}),void 0!==a)for(var s in a)if(a.hasOwnProperty(s)){var u=a[s],d=u.length,c=u[0];c.qty=d,n.push(c)}return n},n.prototype.resolveUnasignedItems=function(e){var r=[],n=[],a=e.orderedItems;return e.orderedOffers.forEach(function(r){r.orderedItems.length&&(r.items=[],r.orderedItems.forEach(function(t){var e=a.find(function(e){return e._id===t});e&&(r.items.push(e),n.push(e))}))}),a.forEach(function(t){t.cancellation||n.find(function(e){return e._id===t._id})||r.push(t)}),r},n)},function(e,t,r){"use strict";function n(e){a=new window.OrderDataLib.TranslateService({local:e.local}),o=new window.OrderDataLib.UserService}var a,o,i,s,u,d,c,T,E,l;window.OrderDataLib.HistoriesService=(o=a=void 0,i="kickout",s="resume",u="suspend",d="manual",c="manager",T="other",E=function(e){if(e.action===u){if(e.data.source===d)return a.getText("SUSPEND_MANUAL");if(e.data.source===c)return a.getText("SUSPEND_MANAGER");if(e.data.source===T)return a.getText("SUSPEND_OTHER")}if(e.action===s)return a.getText("RESUME")},l=function(e){return e===s?a.getText("RESUME"):e===u?a.getText("SUSPEND"):void 0},n.prototype.resolveHistoriesToTimeLine=function(e,t){var r=t.users,n=[],a=e.history;return a&&0<a.length&&a.forEach(function(e){e.action!==u&&e.action!==s||n.push({action:l(e.action),data:E(e),at:e.at,by:o.resolveUserName({userId:e.by,users:r})}),e.action===i&&n.push({action:e.action,data:"Device name: "+e.deviceName,at:e.at,by:o.resolveUserName({userId:e.by,users:r})})}),n},n)},function(e,t,r){"use strict";function n(e){}window.OrderDataLib.DishesService=(n.prototype.resolveDishes=function(e){var t=[],r={};if(e.orderedOffers.forEach(function(e){e.quantitySaleId?(void 0===r[e.quantitySaleId]&&(r[e.quantitySaleId]=[]),r[e.quantitySaleId].push(e)):t.push(e)}),void 0!==r)for(var n in r)if(r.hasOwnProperty(n)){var a=r[n],o=a.length,i=a[0];i.qty=o,t.push(i)}return t=t.map(function(e){return e.qty&&(e.amount=e.qty*e.amount),e})},n)},function(e,t,r){"use strict";function n(e){m=new window.OrderDataLib.TranslateService({local:e.local}),p=new window.OrderDataLib.UserService,new window.OrderDataLib.Utils}var m,p,l;window.OrderDataLib.DiscountsService=(p=m=void 0,l="OTH",n.prototype.resolveDiscounts=function(e){var a=[],n=[],t=JSON.parse(JSON.stringify(e.rewards)),o=e.orderedDiscounts,i=e.orderedOffers,r=e.orderedItems,s={};if(t.forEach(function(t){var r=o.find(function(e){return e._id===t.promotion});if(r){var e=i.find(function(e){return e._id===r.target});t.md={orderedDiscount:r,offer:e},t.type="reward",n.push(t)}}),n.forEach(function(e){var t=e.md.offer;t&&t.quantitySaleId?(void 0===s[t.quantitySaleId]&&(s[t.quantitySaleId]=[]),s[t.quantitySaleId].push(e)):a.push(e)}),e.onTheHouse){var u=_.get(e,"onTheHouse.reason.othType");a.push({type:"onTheHouse",discountType:l,amount:e.totalAmount/100,reasonName:_.get(e,"onTheHouse.reason.name")+": "+_.get(e,"onTheHouse.comment"),reasonType:_.isEmpty(u)?"":m.getText("OTH_TYPE_"+u.toUpperCase())})}else if(r.forEach(function(t){var e=i.find(function(e){return t._id===_.get(e,"orderedItems[0]")});if(e&&e.onTheHouse&&e.onTheHouse.approved){var r=_.get(e,"onTheHouse.reason.othType"),n={type:"onTheHouse",discountType:l,amount:e?e.amount:0,reasonName:function(e){var t="";return e.name&&(t+=""+e.name),void 0!==e.qty&&(t+=" "+e.qty+"x"),void 0!==_.get(e,"onTheHouse.reason.name")&&(t+=" - "+e.onTheHouse.reason.name),void 0!==_.get(e,"onTheHouse.comment")&&(t+=" : "+e.onTheHouse.comment),t}(t),reasonType:_.isEmpty(r)?"":m.getText("OTH_TYPE_"+e.onTheHouse.reason.othType.toUpperCase())};e.quantitySaleId?(void 0===s[e.quantitySaleId]&&(s[e.quantitySaleId]=[]),s[e.quantitySaleId].push(n)):a.push(n)}}),void 0!==s)for(var d in s)if(s.hasOwnProperty(d)){var c=s[d],T=c.length,E=c[0];E.qty=T,a.push(E)}return a=a.map(function(e){if(e.qty){var t=0,r=_.get(e,"discount.amount");t=void 0!==r?r:e.amount,e.totalAmount=e.qty*t}return e})},n.prototype.resolveDiscountsCollection=function(e){var n=[];return e.forEach(function(e){if("reward"===e.type){var t=e._type,r=_.get(e,"md.orderedDiscount.reason.othType");n.push({discountType:function(e,t){var r=0;switch(e){case"PercentOffOrder":r=t.discount.percentage+"%";break;case"AmountOff":case"AmountOffOrder":r=void 0;break;case"PercentOff":r=t.discount.percentage+"%"}var n="";return r&&(n=r+" "),_.isEmpty(e)||(n+=m.getText(e.toUpperCase())),1<t.qty&&(n+=" "+t.qty+"x "),n}(t,e),amount:e.discount.amount,reasonName:_.get(e,"md.orderedDiscount.reason.name"),totalAmount:e.totalAmount,reasonType:_.isEmpty(r)?"":m.getText("OTH_TYPE_"+r.toUpperCase())})}else"onTheHouse"===e.type&&(e.totalAmount=0,e.amount=0),n.push(e)}),n},n.prototype.resolveDiscountsTimeLine=function(e,t){var d=t.users,c=e.orderedOffers,r=e.orderedDiscounts,n=JSON.parse(JSON.stringify(e.rewards)),T=[],E=[];if(r.length){var l={};n.forEach(function(t){t.requiredResources&&t.requiredResources.forEach(function(e){e.orderedDiscount&&(l[e.orderedDiscount]=t)})});var f={};for(var a in r.forEach(function(e){var t,r,n=l[e._id],a=(r="",(t=n)&&t.requiredResources&&t.requiredResources[0]&&t.requiredResources[0].orderedOffer&&(r=c.find(function(e){return e._id===t.requiredResources[0].orderedOffer})),r),o=void 0,i=void 0,s=void 0!==e.reason?e.reason.name:"--";if(n&&n._type){switch(n._type){case"PercentOffOrder":i=m.getText("PERCENT_OFF_ORDER")+" "+n.discount.percentage+"%",o=s;break;case"AmountOffOrder":i=m.getText("AMOUNT_OFF_ORDER")+" "+n.discount.amount/100,o=s;break;case"PercentOff":i=m.getText("PERCENT_OFF_ITEM")+" "+n.discount.percentage+"%",o=s;break;case"AmountOff":i=m.getText("AMOUNT_OFF_ORDER")+" "+n.discount.amount/100,o=s}n&&n.discount&&n.discount.amount&&(e.discountAmount=n.discount.amount),e.comment&&(o+=": "+e.comment);var u={action:i,data:o,name:a.name,at:e.applied?e.applied.at:"",by:p.resolveUserName({userId:_.get(e,"applied.by"),users:d})};a.quantitySaleId?(void 0===f[a.quantitySaleId]&&(f[a.quantitySaleId]=[]),f[a.quantitySaleId].push(u)):void 0===n&&u?0===E.length&&E.push(u):T.push(u)}}),f)if(f.hasOwnProperty(a)){var o=f[a],i=o[0];i.qty=o.length,T.push(i)}}return T.concat(E)},n.prototype.resolveTotalDiscount=function(e){var t=JSON.parse(JSON.stringify(e.rewards)),r="",n="";return t.forEach(function(e){var t=e.discount;t&&t&&!t.rewardedResources&&(r=t.amount,n=e.manual?m.getText("INITIATED_DISCOUNT"):e.name)}),{totalDiscount:r,totalDiscountName:n}},n)},function(e,t,r){"use strict";function n(){i=new window.OrderDataLib.UserService}var i,s;window.OrderDataLib.CoursesService=(i=void 0,s=["notified","fired","served","prepared","taken"],n.prototype.resolveCourses=function(e,t){var r=t.users,n=e.courses,a=e.orderedItems,o=e.cancelledOffers;return n&&n.length&&n.forEach(function(n){s.forEach(function(e){n[e]&&(n[e].waiter=i.resolveUserName({userId:n[e].by,users:r})),n.orderedItems&&0<n.orderedItems.length&&(n.enrichItems=[],n.orderedItems.forEach(function(t){var e=a.find(function(e){return e._id===t});e&&n.enrichItems.push(e);var r=o.find(function(e){return e._id===t});r&&n.enrichItems.push(r)}))})}),n},n)}]);